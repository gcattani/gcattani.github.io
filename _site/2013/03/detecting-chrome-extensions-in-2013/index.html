<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8">
      <meta name="description" content=Giovanni Cattani's Blog>
      <meta name="author" content=Giovanni Cattani>
      <meta name="viewport" content="width=device-width">
      <link rel="stylesheet" href="/css/syntax.css">
      <link rel="stylesheet" href="/css/main.css">
      <link rel="stylesheet" href="/css/normalize.css">
      <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
      <link rel="icon" href="/favicon.ico" type="image/x-icon">
      <link rel="alternate" type="application/atom+xml" href="/atom.xml">
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
      <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script>
   (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
   m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
   })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

   ga('create', 'UA-39540268-1', 'gcattani.co.vu');
   ga('send', 'pageview');
</script>

      <title>Detecting Chrome Extensions in 2013</title>
   </head>
   
   <body>
      <main>
         <header>
            <h1 class="title"><a href="/">BoringSec</a></h1>
         </header>

         <article>
   <h2>Detecting Chrome Extensions in 2013</h2>
   <hr>
   <p>Detecting Google Chrome extension has always been a trivial job, as highlighted by <a href="http://www.skeletonscribe.net/2011/07/sparse-bruteforce-addon-scanner.html">previous</a> <a href="http://blog.kotowicz.net/2012/02/intro-to-chrome-addons-hacking.html">researches</a>. It was all a matter of finding the extension ID and to try loading its <em>manifest.json</em> file, which is always located in the extension&#39;s root directory:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">chrome-extension://abcdefghijklmnopqrstuvwxyz0123456789/manifest.json
</code></pre></div>
<p>However, in the latest version of Chrome, some attempts at loading the manifest were greeted with an unpleasent message:</p>

<blockquote>
<p>Denying load of chrome-extension://abcdefghijklmnopqrstuvwxyz0123456789/manifest.json. Resources must be listed in the web_accessible_resources manifest key in order to be loaded by pages outside the extension.</p>
</blockquote>

<p>What the heck is the <em>web<em>accessible</em>resources manifest key</em>? A quick look at the manifest file highlights the following array:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">&quot;web_accessible_resources&quot;: [ &quot;logo.png&quot;, &quot;menu.html&quot;, &quot;style.css&quot; ]
</code></pre></div>
<p>Since Chrome 18, Google deprecated manifest version 1 and its support will be decreasing, making the old version unavailable in September 2013. Among the differences between <a href="https://developer.chrome.com/dev/extensions/manifestVersion.html#manifest-v1-changes">version 1 and 2</a>, Google introduced the <a href="https://developer.chrome.com/dev/extensions/manifest.html#web_accessible_resources">web<em>accessible</em>resources</a> array, which determines the local resources that can be loaded by external sources.</p>

<p>So, if the manifest file doesn&#39;t include it (ie. it&#39;s still version 1), any resource in the extension&#39;s directory can be loaded by external pages. Otherwise, if the file uses already the newer version (shown as <code>&quot;manifest_version&quot;: 2</code>) and includes a <em>web<em>accessible</em>resources</em> array, only the listed resources can be loaded.</p>

<p>A generic JavaScript approach, which works for text files and pictures alike, builds a <code>script</code> element and sets its source to the desired file. The following code is just an example:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">scriptSrc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;script&quot;</span><span class="p">);</span>            
<span class="nx">scriptSrc</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;onload&quot;</span><span class="p">,</span> <span class="s2">&quot;[ONLOAD CODE]&quot;</span><span class="p">);</span>
<span class="nx">scriptSrc</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;chrome-extension://&quot;</span> <span class="o">+</span> <span class="nx">resource</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">scriptSrc</span><span class="p">);</span></code></pre></div>

<p>While the previous code works for every type of file, an approach specific to picture files can be used if needed. The following code creates an <code>img</code> element:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">imgSrc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&quot;img&quot;</span><span class="p">);</span>
<span class="nx">imgSrc</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;border&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">);</span>
<span class="nx">imgSrc</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">);</span>
<span class="nx">imgSrc</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">);</span>
<span class="nx">imgSrc</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;onload&quot;</span><span class="p">,</span> <span class="s2">&quot;[ONLOAD CODE]&quot;</span><span class="p">);</span>
<span class="nx">imgSrc</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&quot;src&quot;</span><span class="p">,</span> <span class="s2">&quot;chrome-extension://&quot;</span> <span class="o">+</span> <span class="nx">resource</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">imgSrc</span><span class="p">);</span></code></pre></div>

<p>While probably requiring updates to existing detection code, <em>web<em>accessible</em>resources</em> won&#39;t stop specific loading attempts, making extension detection still possible.</p>

</article>

<footer>
   <div id="date" class="meta">
      23 Mar 2013
   </div>
   <div id="return">
      <a href="/">&laquo; Home Page</a>
   </div>
   <br>
</footer>

      </main>
   </body>
</html>
